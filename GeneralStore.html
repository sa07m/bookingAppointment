<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BEST General Store</title>
</head>
<body>
    
    <form onsubmit="submitfunc(event)">
        <h1 style="text-align: center;">BEST General Store</h1>
        <label>Item Name</label>
        <input type="text" id="name">
        <label>Description</label>
        <input type="text" id="desc">
        <label>Price</label>
        <input type="text" id="price">
        <label>Quantity</label>
        <input type="text" id="quantity">
        <button type="submit" >Add Item</button>
    </form>

    <ul id="list"></ul>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.3/axios.min.js"></script>
    <script>
        function submitfunc(e){
            e.preventDefault()
            var name=document.getElementById('name').value
            var desc=document.getElementById('desc').value
            var price=document.getElementById('price').value
            var quantity=document.getElementById('quantity').value

            var obj = {
                name,
                desc,
                price,
                quantity
            }
            //console.log(obj.name+' '+obj.desc+' '+obj.price+' '+obj.quantity)

            axios.post('https://crudcrud.com/api/8c94bf23afe54d7c9064b29691a0cd4c/inventory',obj)
            .then(res=>display(res.data))
            .catch(err=>console.log(err))

            document.getElementById('name').value=''
            document.getElementById('desc').value=''
            document.getElementById('price').value=''
            document.getElementById('quantity').value=''

        }

        function display(obj){
            console.log('entering display function')
            var li = document.createElement('li')
            li.appendChild(document.createTextNode(obj.name+' --- '+obj.desc+' --- '+obj.price+' --- '+obj.quantity))
            const buy1= document.createElement('button')
            buy1.appendChild(document.createTextNode('BUY 1'))
            buy1.type="button"

            const buy2= document.createElement('button')
            buy2.appendChild(document.createTextNode('BUY 2'))
            buy2.type="button"

            const buy3= document.createElement('button')
            buy3.appendChild(document.createTextNode('BUY 3'))
            buy3.type="button"
            li.appendChild(buy1)
            li.append('     ')
            li.appendChild(buy2)
            li.append('     ')
            li.appendChild(buy3)
            document.getElementById('list').appendChild(li)

            buy1.onclick = ()=>{

                console.log('editing buy1')
                axios.put(`https://crudcrud.com/api/8c94bf23afe54d7c9064b29691a0cd4c/inventory/${obj._id}`,{
                name:obj.name,
                desc:obj.desc,
                price:obj.price,
                quantity:obj.quantity-1
                })
                .then(()=>{
                    location.reload()
                })

            }
            buy2.onclick = ()=>{

                console.log('editing buy1')
                axios.put(`https://crudcrud.com/api/8c94bf23afe54d7c9064b29691a0cd4c/inventory/${obj._id}`,{
                name:obj.name,
                desc:obj.desc,
                price:obj.price,
                quantity:obj.quantity-2
                })
                .then(()=>{
                    location.reload()
                })

            }
            buy3.onclick = ()=>{

                console.log('editing buy1')
                axios.put(`https://crudcrud.com/api/8c94bf23afe54d7c9064b29691a0cd4c/inventory/${obj._id}`,{
                name:obj.name,
                desc:obj.desc,
                price:obj.price,
                quantity:obj.quantity-3
                })
                .then(()=>{
                    location.reload()
                })

            }
        
        }
        
        window.addEventListener('DOMContentLoaded', async ()=>{
            console.log('dom content loaded')
            var a = await axios.get('https://crudcrud.com/api/8c94bf23afe54d7c9064b29691a0cd4c/inventory')
            .then(res=>res.data)
            .catch(err=>console.log(err))

            for(var i=0; i<a.length; i++){
                display(a[i])
            }
        })
    </script>
    

</body>
</html>